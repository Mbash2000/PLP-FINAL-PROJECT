{% extends 'base.html' %}

{% block pagetitle %}
  AI Engine
{% endblock pagetitle %}

{% block body %}
<div>
  <div class="container">
    <!-- Header -->
    <div class="row mb-5 text-center text-white">
      <div class="col-lg-10 mx-auto">
        <h1 class="display-4" style="padding-top: 2%; font-weight: 400; color: rgb(4, 54, 4);">
          <b>Check</b>
        </h1>
        <p class="lead" style="font-weight: 500; color: black;">
          Let AI Engine Help You To Detect Disease
        </p>
      </div>
    </div>

    <!-- Camera & Capture Section -->
    <div class="row">
      <div class="col mx-auto"></div>

      <div class="col mx-auto">
        <div class="p-5 bg-white shadow rounded-lg" style="height: 95%;">
          <img src="https://www.pngjoy.com/pngl/250/4840262_plants-png-indoors-tropical-plant-png-hd-png.png"
               height="300" width="200" alt="Plant Image" class="d-block mx-auto mb-4 rounded-pill" />

          <!-- Video stream from camera -->
          <video id="video" class="mb-4" autoplay></video>

          <!-- Capture button -->
          <button id="captureButton" class="btn btn-outline-success">Take Photo</button>

          <!-- Captured image & canvas -->
          <canvas id="canvas" style="display: none;"></canvas>
          <img id="capturedImage" class="mb-4" alt="Captured Photo" style="display: none;" />

          <!-- Options after capturing -->
          <div id="options" style="display: none;">
            <button id="cancelButton" class="btn btn-outline-danger mr-2">Cancel</button>
            <button id="retakeButton" class="btn btn-outline-primary mr-2">Retake</button>
            <button id="uploadButton" class="btn btn-outline-success">Upload</button>
          </div>

          <h6 class="text-center mb-4 text-muted">
            Simply take a photo of your plant's leaf, and see the magic of AI.
          </h6>
        </div>
      </div>

      <div class="col mx-auto"></div>
    </div>
  </div>
</div>

<script>
  const video = document.getElementById('video');
  const captureButton = document.getElementById('captureButton');
  const canvas = document.getElementById('canvas');
  const capturedImage = document.getElementById('capturedImage');
  const options = document.getElementById('options');
  const cancelButton = document.getElementById('cancelButton');
  const retakeButton = document.getElementById('retakeButton');
  const uploadButton = document.getElementById('uploadButton');

  // Access the user's camera
  navigator.mediaDevices.getUserMedia({ video: true })
    .then(stream => {
      video.srcObject = stream;
    })
    .catch(error => {
      console.error('Error accessing the camera:', error);
    });

  // Capture photo from video stream
  captureButton.addEventListener('click', () => {
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height);
    capturedImage.src = canvas.toDataURL('image/jpeg');
    capturedImage.style.display = 'block';
    options.style.display = 'block';
  });

  // Cancel capture
  cancelButton.addEventListener('click', () => {
    capturedImage.style.display = 'none';
    options.style.display = 'none';
  });

  // Retake photo
  retakeButton.addEventListener('click', () => {
    capturedImage.style.display = 'none';
    options.style.display = 'none';
  });

  // Upload photo placeholder
  uploadButton.addEventListener('click', () => {
    // TODO: Implement upload functionality here using capturedImage.src
    alert('Upload function not implemented yet.');
    capturedImage.style.display = 'none';
    options.style.display = 'none';
  });
</script>

{% endblock body %}
